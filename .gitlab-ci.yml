stages:
  - test
  - docker-build
#  - staging

code_quality:
  stage: test
  allow_failure: true
  image: node:15-alpine
  script:
    - cd frontend/ && npx prettier --check .

#frontend_tests:
#  stage: test
#  image: node:15-alpine
#  script:
#    - echo "done"

backend_tests:
  stage: test
  image: golang:1.16
  script:
    - cd server/ && go test -v ./...

build_and_push_image:
  stage: docker-build
  only:
    - master
    - 25-add-docker-stuff
  image: docker:dind
  before_script:
    - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
  script:
    - docker build --pull -t $CI_REGISTRY_IMAGE:dev .
    - docker push $CI_REGISTRY_IMAGE:dev

#stage_on_webserver:
#  stage: staging
#  only:
#    - master
#  image: 